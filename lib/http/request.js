/**
 * @author Steven Jimenez <steven@stevethedev.com>
 */
'use strict';

const RequestResponse          = requireLib('core/request-response');
const { _private, _protected } = requireLib('util/scope')();

/**
 * This class provides a standardized interface for how Regent will interact
 * with Node's standard {@link https://nodejs.org/api/http.html|HTTP Request}
 * that was generated by the {@link HttpKernel}.
 */
class HttpRequest extends RequestResponse
{
    /**
     * @param {HttpKernel}           httpKernel  - The owning HTTP Kernel 
     *                                             object where this class is 
     *                                             being instantiated.
     * @param {http.IncomingMessage} httpRequest - The internal NodeJS HTTP 
     *                                             Request that this object 
     *                                             wraps.
     */
    constructor(httpKernel, httpRequest)
    {
        super(httpKernel.getRegent());

        const self = _private(this);

        /**
         * This is a reference to the owning HTTP kernel object which generated
         * this instance.
         * 
         * @private
         * @type {HttpKernel}
         */
        self.httpKernel  = httpKernel;

        /**
         * This is a reference to the internal NodeJS HTTP Request that this
         * instance wraps.
         *
         * @private
         * @type {http.IncomingMessage}
         */
        self.httpRequest = httpRequest;

        _protected(this).cookies.parse(this.getHeader('cookie') || '');
    }

    /**
     * Retrieve the HTTP Method that triggered this request object.
     *
     * @return {String}
     */
    getMethod()
    {
        return _private(this).httpRequest.method;
    }

    /**
     * Retrieve the HTTP Header from the request object.
     *
     * @param {String} name
     *
     * @return {String}
     */
    getHeader(name)
    {
        const headers = _private(this).httpRequest.headers;
        if (Object.prototype.hasOwnProperty.call(headers, name)) {
            return headers[name];
        }
        return null;
    }

    /**
     * Retrieve the URI that triggered this request object, excluding the
     * scheme, host, and port.
     *
     * @return {String}
     */
    getUri()
    {
        const self = _private(this);
        if (!self || !self.httpRequest || !self.httpRequest.url) {
            return '';
        }
        return self.httpRequest.url;
    }
}

module.exports = HttpRequest;
